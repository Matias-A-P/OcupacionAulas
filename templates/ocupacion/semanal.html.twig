{% extends 'base.html.twig' %}

{% block title %}Ocupacion
{% endblock %}
{% block stylesheets %}
	{{ parent() }}
	<link href="{{ asset('styles/tabla_ocup.css') }}" rel="stylesheet"/>
{% endblock %}
{% block cardheader %}
	<div class="col-sm-3">
		<h5><i class="bi bi-bank"></i> {{ app.session.get('edificio') }}</h5>
	</div>
	<div class="col-sm-5">
	<div class="d-flex justify-content-center">
		<a class="btn btn-sm btn-outline-secondary mx-3" href="{{ path('ocupacion_index', {dia: date()}) }}" role="button">
		<i class="bi bi-calendar4-event"></i>
		</a>
		<a class="btn btn-sm btn-outline-secondary" href="{{ path('ocupacion_index', {dia: fecha|date_modify("-7 day")|date('Y-m-d'), vista: 'semanal'}) }}" role="button">
			<i class="bi bi-arrow-left"></i>
		</a>
		<div class="text-verdelogo fw-bold mx-3">{{fecha|date('d/m/Y')}}</div>
		<a class="btn btn-sm btn-outline-secondary" href="{{ path('ocupacion_index', {dia: fecha|date_modify("+7 day")|date('Y-m-d'), vista: 'semanal'}) }}" role="button">
			<i class="bi bi-arrow-right"></i>
		</a>
	</div></div>
	{{ include("ocupacion/_form_filtro_area.html.twig", {vista: "semanal"}) }}
{% endblock %}
{% block cardbody %}
	<div class="container-fluid">
		<div class="table-responsive">
			<table class="table table-sm table-hover table-borderless align-top text-center" id="tablaOcup">
				<thead class="table-light text-verdelogo">
					<tr class="bg-light-gray">
						<th class="col-sm-1">Aula</th>
						<th class="col-sm-1">LUNES<br><small>{{ fecha|date('d-m-Y') }}</small></th>
						<th class="col-sm-1">MARTES<br><small>{{ fecha|date_modify("+1 day")|date('d-m-Y') }}</small></th>
						<th class="col-sm-1">MIERCOLES<br><small>{{ fecha|date_modify("+2 day")|date('d-m-Y') }}</small></th>
						<th class="col-sm-1">JUEVES<br><small>{{ fecha|date_modify("+3 day")|date('d-m-Y') }}</small></th>
						<th class="col-sm-1">VIERNES<br><small>{{ fecha|date_modify("+4 day")|date('d-m-Y') }}</small></th>
						<th class="col-sm-1">SABADO<br><small>{{ fecha|date_modify("+5 day")|date('d-m-Y') }}</small></th>
					</tr>
				</thead>
				<tbody>
					{% set a = 0 %}
					{% for aula in aulas %}
						<tr>
						<td class="align-middle">
							{{aula.Aula}}<br>
							{{aula.getIdPiso}}
							<div class="text-muted">Capacidad:{{aula.capacidad}}</div>
						</td>

						<td>
						{% set ocups = lunes[a] %}
						{% set cant = ocups|length %}
						{% set i = 0 %}
						{% for idx in range(0,cant-1) %}
							{% if idx>i or idx==0 %}	
								{% set i = idx %}				
								{% set ocup = ocups[i] %}								
							{% set ocup = ocups[i] %}						
							{% if ocup.id is null %}
								<div class="text-muted">LUNES</div>
								{# {{ path('ocupacion_new', {aula: ocup.IdAula.id, dia: fecha|date('Y-m-d'), hora: "14:00"|date('H:i')}) }} #}
								{% if is_granted("ROLE_ADMIN") %}
								<a href="javascript:void(0)" data-ref={{ path('ocupacion_new') }} data-id-aula={{ocup.IdAula.id}} data-dia={{fecha|date('Y-m-d')}} data-hora="14:00" onclick="nueva(this);"><i class="bi bi-plus-square"></i></a>
								{% endif %}
							{% else %}		
								{% include 'ocupacion/_td_ocup_sem.html.twig' %}	 
									{% set break = false %}
									{% for c in range(1,9) %}
									{% if i+1 < cant and not break%}
										{% set ocupSig = ocups[i+1] %}
										{% if ocupSig.IdCatedra==ocup.IdCatedra and ocupSig.horaInicio==ocup.horaInicio and ocupSig.IdAula==ocup.IdAula %}
											<a href="javascript:void(0)" rel="nofollow" id="btn-edit" data-edit-id="{{ ocupSig.id }}" onclick="editar(this);">
											<div class="badge bg-secondary text-white">{{ocupSig.comision}}</div></a>
											{% set i = (i+1) %}
										{% else %}
											{% set break = true %}
										{% endif %}
									{% endif %}
									{% endfor %}
									<br>								
							{% endif %}	
							<br>			
							{% if idx==i %} {% set i = (i+1) %} {% endif %}
							{% endif %}	
						{% endfor %}
						</td>

						<td>
						{% set ocups = martes[a] %}
						{% set cant = ocups|length %}
						{% set i = 0 %}
						{% for idx in range(0,cant-1) %}
							{% if idx>i or idx==0 %}	
								{% set i = idx %}				
								{% set ocup = ocups[i] %}						
								{% if ocup.id is null %}								
									<div class="text-muted">MARTES</div>
									{% if is_granted("ROLE_ADMIN") %}
										<a href="javascript:void(0)" data-ref={{ path('ocupacion_new') }} data-id-aula={{ocup.IdAula.id}} data-dia={{fecha|date_modify("+1 day")|date('Y-m-d')}} data-hora="14:00" onclick="nueva(this);"><i class="bi bi-plus-square"></i></a>
										{# <a href="{{ path('ocupacion_new', {aula: ocup.IdAula.id, dia: fecha|date_modify("+1 day")|date('Y-m-d'), hora: "14:00"|date('H:i')}) }}" class=""></a> #}
									{% endif %}
								{% else %}	
									{% include 'ocupacion/_td_ocup_sem.html.twig' %}	
									{% set break = false %}
									{% for c in range(1,9) %}
									{% if i+1 < cant and not break%}
										{% set ocupSig = ocups[i+1] %}
										{% if ocupSig.IdCatedra==ocup.IdCatedra and ocupSig.horaInicio==ocup.horaInicio and ocupSig.IdAula==ocup.IdAula %}
											<a href="javascript:void(0)" rel="nofollow" id="btn-edit" data-edit-id="{{ ocupSig.id }}" onclick="editar(this);">
											<div class="badge bg-secondary text-white">{{ocupSig.comision}}</div></a>
											{% set i = (i+1) %}
										{% else %}
											{% set break = true %}
										{% endif %}
									{% endif %}
									{% endfor %}
									<br>	
								{% endif %}	
								<br>							
							{% endif %}					
						{% endfor %}
						</td>

						<td>
						{% set ocups = miercoles[a] %}
						{% set cant = ocups|length %}
						{% set i = 0 %}
						{% for idx in range(0,cant-1) %}
							{% if idx>i or idx==0 %}	
								{% set i = idx %}				
								{% set ocup = ocups[i] %}						
								{% if ocup.id is null %}								
									<div class="text-muted">MIERCOLES</div>
									{% if is_granted("ROLE_ADMIN") %}
										<a href="javascript:void(0)" data-ref={{ path('ocupacion_new') }} data-id-aula={{ocup.IdAula.id}} data-dia={{fecha|date_modify("+2 day")|date('Y-m-d')}} data-hora="14:00" data-vista="semanal" onclick="nueva(this);"><i class="bi bi-plus-square"></i></a>
									{% endif %}
								{% else %}		
									{% include 'ocupacion/_td_ocup_sem.html.twig' %}
									{% set break = false %}
									{% for c in range(1,9) %}
									{% if i+1 < cant and not break%}
										{% set ocupSig = ocups[i+1] %}
										{% if ocupSig.IdCatedra==ocup.IdCatedra and ocupSig.horaInicio==ocup.horaInicio and ocupSig.IdAula==ocup.IdAula %}
											<a href="javascript:void(0)" rel="nofollow" id="btn-edit" data-edit-id="{{ ocupSig.id }}" onclick="editar(this);">
											<div class="badge bg-secondary text-white">{{ocupSig.comision}}</div></a>
											{% set i = (i+1) %}
										{% else %}
											{% set break = true %}
										{% endif %}
									{% endif %}
									{% endfor %}
									<br>
								{% endif %}				
								<br>
							{% endif %}								
						{% endfor %}
						</td>

						<td>
						{% set ocups = jueves[a] %}
						{% set cant = ocups|length %}
						{% set i = 0 %}
						{% for idx in range(0,cant-1) %}
							{% if idx>i or idx==0 %}	
								{% set i = idx %}				
								{% set ocup = ocups[i] %}						
							{% if ocup.id is null %}								
								<div class="text-muted">JUEVES</div>
								{% if is_granted("ROLE_ADMIN") %}
								<a href="javascript:void(0)" data-ref={{ path('ocupacion_new') }} data-id-aula={{ocup.IdAula.id}} data-dia={{fecha|date_modify("+3 day")|date('Y-m-d')}} data-hora="14:00" onclick="nueva(this);"><i class="bi bi-plus-square"></i></a>
								{% endif %}
							{% else %}		
								{% include 'ocupacion/_td_ocup_sem.html.twig' %}	
									{% set break = false %}
									{% for c in range(1,9) %}
									{% if i+1 < cant and not break%}
										{% set ocupSig = ocups[i+1] %}
										{% if ocupSig.IdCatedra==ocup.IdCatedra and ocupSig.horaInicio==ocup.horaInicio and ocupSig.IdAula==ocup.IdAula %}
											<a href="javascript:void(0)" rel="nofollow" id="btn-edit" data-edit-id="{{ ocupSig.id }}" onclick="editar(this);">
											<div class="badge bg-secondary text-white">{{ocupSig.comision}}</div></a>
											{% set i = (i+1) %}
										{% else %}
											{% set break = true %}
										{% endif %}
									{% endif %}
									{% endfor %}
									<br>								
							{% endif %}	
							<br>
							{% endif %}				
						{% endfor %}
						</td>

						<td>
						{% set ocups = viernes[a] %}
						{% set cant = ocups|length %}
						{% set i = 0 %}
						{% for idx in range(0,cant-1) %}
							{% if idx>i or idx==0 %}	
								{% set i = idx %}				
								{% set ocup = ocups[i] %}						
							{% if ocup.id is null %}								
								<div class="text-muted">VIERNES</div>
								{% if is_granted("ROLE_ADMIN") %}
								<a href="javascript:void(0)" data-ref={{ path('ocupacion_new') }} data-id-aula={{ocup.IdAula.id}} data-dia={{fecha|date_modify("+4 day")|date('Y-m-d')}} data-hora="14:00" onclick="nueva(this);"><i class="bi bi-plus-square"></i></a>
								{% endif %}
							{% else %}	
								{% include 'ocupacion/_td_ocup_sem.html.twig' %}	
									{% set break = false %}
									{% for c in range(1,9) %}
									{% if i+1 < cant and not break%}
										{% set ocupSig = ocups[i+1] %}
										{% if ocupSig.IdCatedra==ocup.IdCatedra and ocupSig.horaInicio==ocup.horaInicio and ocupSig.IdAula==ocup.IdAula %}
											<a href="javascript:void(0)" rel="nofollow" id="btn-edit" data-edit-id="{{ ocupSig.id }}" onclick="editar(this);">
											<div class="badge bg-secondary text-white">{{ocupSig.comision}}</div></a>
											{% set i = (i+1) %}
										{% else %}
											{% set break = true %}
										{% endif %}
									{% endif %}
									{% endfor %}
									<br>									
							{% endif %}	
							<br>	
							{% endif %}			
						{% endfor %}
						</td>

						<td>
						{% set ocups = sabado[a] %}
						{% set cant = ocups|length %}
						{% set i = 0 %}
						{% for idx in range(0,cant-1) %}
							{% if idx>i or idx==0 %}	
								{% set i = idx %}				
								{% set ocup = ocups[i] %}						
							{% if ocup.id is null %}								
								<div class="text-muted">SABADO</div>
								{% if is_granted("ROLE_ADMIN") %}
								<a href="javascript:void(0)" data-ref={{ path('ocupacion_new') }} data-id-aula={{ocup.IdAula.id}} data-dia={{fecha|date_modify("+5 day")|date('Y-m-d')}} data-hora="14:00" onclick="nueva(this);"><i class="bi bi-plus-square"></i></a>
								{% endif %}
							{% else %}		
								{% include 'ocupacion/_td_ocup_sem.html.twig' %}
									{% set break = false %}
									{% for c in range(1,9) %}
									{% if i+1 < cant and not break%}
										{% set ocupSig = ocups[i+1] %}
										{% if ocupSig.IdCatedra==ocup.IdCatedra and ocupSig.horaInicio==ocup.horaInicio and ocupSig.IdAula==ocup.IdAula %}
											<a href="javascript:void(0)" rel="nofollow" id="btn-edit" data-edit-id="{{ ocupSig.id }}" onclick="editar(this);">
											<div class="badge bg-secondary text-white">{{ocupSig.comision}}</div></a>
											{% set i = (i+1) %}
										{% else %}
											{% set break = true %}
										{% endif %}
									{% endif %}
									{% endfor %}
									<br>									
							{% endif %}	
							<br>	
							{% endif %}			
						{% endfor %}
						</td>

						{% set a = a+1 %}
					{% endfor %}
				</tbody>
			</tbody>
		</tr>
	</tbody>
</tr></tbody></table>
{% include "ocupacion/_modales.html.twig" %}
</div></div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{{ asset('js/ocupacion.js') }}"></script>
<script>
{% endblock %}